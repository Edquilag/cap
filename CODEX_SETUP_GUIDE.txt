CODEX SETUP GUIDE (for cloned repo on another machine)
======================================================

1) Prerequisites
- Python 3.12+
- Node.js 20+
- npm 10+
- Optional but recommended for scale: PostgreSQL 14+

2) Clone
- git clone https://github.com/Edquilag/cap.git
- cd cap

3) Backend setup (Terminal 1)
- cd backend
- python -m venv .venv
- .venv\Scripts\activate
- pip install -r requirements.txt
- Copy-Item .env.example .env

Default run mode uses SQLite (`backend/zonalhub.db`).

To use PostgreSQL, set in `backend/.env`:
DATABASE_URL=postgresql+psycopg://<user>:<password>@localhost:5432/<db_name>

Optional export cap tuning (default 50000):
EXPORT_MAX_ROWS=50000

Start backend:
- uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

4) Frontend setup (Terminal 2)
- cd frontend
- npm install
- Copy-Item .env.example .env
- npm run dev

Frontend:
- http://localhost:5173

Backend docs:
- http://localhost:8000/docs

Health:
- http://localhost:8000/health

5) Data operations
- Fetch official BIR files:
  cd backend
  .venv\Scripts\activate
  python scripts\fetch_bir_zonal_files.py

- Ingest extracted workbooks:
  python scripts\ingest_from_folder.py --folder ..\data\raw\bir_zonal\extracted --dataset-version BIR-ZONAL-YYYY-MM-DD

- Migrate SQLite to PostgreSQL:
  python scripts\migrate_sqlite_to_postgres.py --batch-size 20000

6) Current UI flow and features
- Home: searchable Region dropdown -> Province cards
- Province page: city/municipality cards
- Barangay page: barangay cards
- Zonal page:
  - street-priority search (`Exact` + catch-all fallback policy)
  - DO/Year dataset switcher + optional comparison
  - summary cards (min/median/max/count/class mix)
  - precision badges (`Exact`, `Catch-all`, `Special case`)
  - modal details with source transparency
  - CSV/XLSX export

7) Notes for Codex
- Read `README.md` then `docs/README.md`.
- Keep `.env`, local DB files, raw downloaded data, and node_modules out of commits.
- Run checks after edits:
  - backend compile: `python -m compileall app` (inside `backend`)
  - frontend build: `npm run build` (inside `frontend`)
- If using PostgreSQL, restart backend after changing `DATABASE_URL`.
